/***************************************************************/
/*                                                             */
/*      PROJECT NAME :  rx210                                  */
/*      FILE         :  rx210.c                                */
/*      DESCRIPTION  :  Main Program                           */
/*      CPU SERIES   :  RX200                                  */
/*      CPU TYPE     :  RX210                                  */
/*                                                             */
/*      This file is generated by e2 studio.                   */
/*                                                             */
/***************************************************************/                                
                                                                           
                                                                           
/************************************************************************/
/*    File Version: V1.00                                               */
/*    Date Generated: 08/07/2013                                        */
/************************************************************************/

#include "iodefine.h"
#include "RPBRX210.h"
#include "decoder_quadra.h"
#include "pwm_asser_RX210.h"
#include "asservissement.h"
#include "uart.h"
//#include "odometrie.h"


#ifdef CPPAPP
//Initialize global constructors
extern "C" void __main()
{
  static int initialized;
  if (! initialized)
    {
      typedef void (*pfunc) ();
      extern pfunc __ctors[];
      extern pfunc __ctors_end[];
      pfunc *p;

      initialized = 1;
      for (p = __ctors_end; p > __ctors; )
    (*--p) ();

    }
}
#endif 
//init des variables globales
int compteur=0;
int i = 0;

//fin init variables globales
void initialisation()
{
	init_mtclk();		//init of decoder
	mtclk_start();		//run decoder

	init_pwm_asser(0x3e8);//init pwm control motors

	init_echant();		//init echantillons
	init_variable_echant();

	uart9_init();		//init HW de l'uart
	init_hach_char();	//init of adress tables
	init_hach_sht();
	init_hach_int();
	init_hach_flt();
	active_reception();	//activation of uart reception

	start_echant();		//start echantillonnage for asserv
}	
int main(void)
{
	LED1_OFF;LED0_OFF;LED2_OFF;
	initialisation();

	while(1)
	{
		
		if(read_step()==1)
		{
			read_uart();
		}
		if(SW1==0)
		{
			LED0=~LED0;
			send_dist();
			send_dist();
			send_dist();
			send_end_transmi();
			while(SW1==0){}
			for(int i = 0;i<1000;i++){}
		}
	}
	return 0;
}
